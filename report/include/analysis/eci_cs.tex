
\pgfmathsetmacro{\viewtheta}{60}
\pgfmathsetmacro{\viewphi}{120}
\pgfmathsetmacro{\rvec}{5}
\pgfmathsetmacro{\thetavec}{60}
\pgfmathsetmacro{\phivec}{100}
\pgfmathsetmacro{\rvectarget}{5}
\pgfmathsetmacro{\thetavectarget}{90}
\pgfmathsetmacro{\phivectarget}{40}

\tdplotsetmaincoords{\viewtheta}{\viewphi}

\begin{tikzpicture}[scale=1,tdplot_main_coords]

% Draw Globe
\coordinate (O) at (0,0,0);
\draw [thick] (0, 0, 0)  coordinate (pos1);
\shade[ball color=black!10!white,opacity=0.5] (pos1) circle (2cm);
\draw (pos1) circle (2cm);
\tdplotdrawarc[tdplot_main_coords]{(0,0,0)}{2}{-\viewtheta}{\viewphi}{}{}
%\tdplotdrawarc[tdplot_main_coords,dashed]{(0,0,0)}{2}{\viewphi}{360-\viewtheta}{}{}

\tdplotsetthetaplanecoords{0}
\tdplotdrawarc[tdplot_rotated_coords]{(0,0,0)}{2}{-\viewtheta/2}{180-\viewtheta/2}{}{}
%\tdplotdrawarc[tdplot_rotated_coords,dashed]{(0,0,0)}{2}{180-\viewtheta/2}{360-\viewtheta/2}{}{}
\tdplotsetthetaplanecoords{90}
\tdplotdrawarc[tdplot_rotated_coords]{(0,0,0)}{2}{-\viewtheta}{\viewphi}{}{}
%\tdplotdrawarc[tdplot_rotated_coords,dashed]{(0,0,0)}{2}{-\viewtheta}{360-\viewtheta/2}{}{}


% Base Coordinate System
\tdplotsetthetaplanecoords{0}
\draw[thick,->] (0,0,0) -- (4,0,0) node[anchor=north east]{$x_{J}$};
\draw[thick,->] (0,0,0) -- (0,4,0) node[anchor=north west]{$y_{J}$};
\draw[thick,->] (0,0,0) -- (0,0,4) node[anchor=south]{$z_{J}$};


% First Coordinate System
\tdplotsetcoord{P}{\rvec}{\thetavec}{\phivec}
\draw[-stealth,dashed] (O) -- (P) node[near end,anchor=south]{$\mathbf{r}_{J}$};

\tdplotsetrotatedcoordsorigin{(P)}
\tdplotsetthetaplanecoords{40}
\draw[thick,tdplot_rotated_coords,->] (0,0,0) -- (1.5,0,0) node[anchor=south]{$x_{B}$};
\draw[thick,tdplot_rotated_coords,->] (0,0,0) -- (0,1.5,0) node[anchor=west]{$y_{B}$};
\draw[thick,tdplot_rotated_coords,->] (0,0,0) -- (0,0,1.5) node[anchor=west]{$z_{B}$};

% Second Coordinate System
\tdplotsetcoord{Q}{\rvectarget}{\thetavectarget}{\phivectarget}
\draw[-stealth,dashed] (O) -- (Q) node[midway,anchor=east]{$\mathbf{t}_{J}$};

\tdplotsetrotatedcoordsorigin{(Q)}
\shade[ball color=red,tdplot_rotated_coords] (0,0,0) circle (0.1cm);

% Draw Target Vector
\draw[-stealth,dashed] (P) -- (Q) node[midway,anchor=south]{$\mathbf{t}_{B}$};


\end{tikzpicture}
